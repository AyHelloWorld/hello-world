
gswyhq@gswyhq-PC:~ docker pull taskrabbit/elasticsearch-dump
Using default tag: latest
latest: Pulling from taskrabbit/elasticsearch-dump
1160f4abea84: Pull complete
6e17e6655d0c: Pull complete
Digest: sha256:06a1a35aa62fc3326565d5cbac428f42486889d813c99d38b0996c18e83e9f71
Status: Downloaded newer image for taskrabbit/elasticsearch-dump:latest

Example:
# 从一个机器迁移索引及数据到另一个机器:
# 第一步： 拷贝analyzer如分词
gswyhq@gswyhq-PC:~$ docker run --rm -ti taskrabbit/elasticsearch-dump   --input=http://192.168.3.250:9200/mingcijieshi   --output=http://192.168.3.105:9200/mingcijieshi   --type=analyzer
# 第二步： 拷贝映射
gswyhq@gswyhq-PC:~$ docker run --rm -ti taskrabbit/elasticsearch-dump   --input=http://192.168.3.250:9200/mingcijieshi   --output=http://192.168.3.105:9200/mingcijieshi   --type=mapping
# 第三步： 拷贝数据
gswyhq@gswyhq-PC:~$ docker run --rm -ti taskrabbit/elasticsearch-dump   --input=http://192.168.3.250:9200/mingcijieshi   --output=http://192.168.3.105:9200/mingcijieshi   --type=data

docker run --rm -ti taskrabbit/elasticsearch-dump \
  --input=http://192.168.3.250:9200/my_index \
  --output=http://192.168.3.105:9200/my_index \
  --type=mapping
docker run --rm -ti taskrabbit/elasticsearch-dump \
  --input=http://192.168.3.250:9200/my_index \
  --output=http://192.168.3.105:9200/my_index \
  --type=data

# 备份索引数据到一个文件:
docker run --rm -ti -v /data:/tmp taskrabbit/elasticsearch-dump \
  --input=http://192.168.3.250:9200/my_index \
  --output=/tmp/my_index_mapping.json \
  --type=mapping

如果需要用 localhost 作为es的host：
docker run --net=host --rm -ti taskrabbit/elasticsearch-dump \
  --input=http://192.168.3.105:9200/my_index \
  --output=http://localhost:9200/my_index \
  --type=data


若不使用docker，则需要安装数据导入、导出插件
　　sudo apt-get install nodejs
　　sudo apt-get install npm
　　sudo npm install elasticdump -g
从数据库导出某个索引数据到文件：
gswyhq@gswyhq-pc:~$ elasticdump --input=http://localhost:9200/music-index --output=/home/gswyhq/ambbr-ai/ambbr/music-index.json --all=true
从数据库导出所有索引数据到文件：
gswyhq@gswyhq-pc:~$ elasticdump --input=http://localhost:9200 --output=/home/gswyhq/ambbr-ai/ambbr/Elasticsearch_all_data.json --all=true

从文件导入数据到数据库：
gswyhq@gswyhq-pc:~$ elasticdump --input=/home/gswyhq/ambbr-ai/ambbr/music-index.json --output=http://localhost:9200/music-index3 --all=true

从一个数据库导出一个索引到另一个数据库：
gswyhq@gswyhq-pc:~$ elasticdump --input=http://localhost:9200/xplan_story_info --output=http://172.26.1.196:9200/xplan_story_info --all=true

elasticdump --input=http://localhost:9200/music-index --output=http://172.26.1.196:9200/music-index --all=true
elasticdump --input=http://172.26.1.196:9200/search-index/test --output=http://localhost:9200/qa-search-index/test --type=mapping
elasticdump --input=http://localhost:9200/qa-search-index/test --output=http://172.26.1.196:9200/qa-search-index/test --all=true


gswyhq@gswyhq-pc:~$ elasticdump --input=http://localhost:9200/music-index --output=http://172.26.1.196:9200/music-index --type=mapping
gswyhq@gswyhq-pc:~$ elasticdump --input=http://localhost:9200/music-index --output=http://172.26.1.196:9200/music-index --all=true


gswyhq@gswyhq-pc:~$ curl -XPUT localhost:9200/qa-search-index
gswyhq@gswyhq-pc:~$ curl -XPUT localhost:9200/qa-search-index/test/_mapping?pretty -d '{"test":{"properties":{"expression": {"type": "string"},"answer": {"type": "string"},"lib": {"type": "string"},"skill": {"type": "string"},"name": {"type": "string"},"id": {"type": "string"},"label": {"type": "string"},"keyword":{"type": "string"},"content": {"analyzer": "ik_max_word","type": "string"}}}}'

elasticdump --input=http://localhost:9200/qa-search-index --output=http://172.26.1.196:9200/qa-search-index --type=mapping
elasticdump --input=http://localhost:9200/qa-search-index --output=http://172.26.1.196:9200/qa-search-index --all=true

./elasticdump  --input=http://192.168.1.1:9200/original --output=http://192.168.1.2:9200/newCopy --type=mapping
--type=mapping ，意思是把原始索引的mapping结构迁移给目标索引。
然后在执行--type=data的
./elasticdump  --input=http://192.168.1.1:9200/original --output=http://192.168.1.2:9200/newCopy --type=data
就可以把数据迁移过去啦
如果索引很多，你还是懒得一个个去迁移，那么你可以改用这个命令：
./elasticdump  --input=http://192.168.1.1:9200/ --output=http://192.168.1.2:9200/ --all=true
加个--all=true，input与output里不需要把索引名加上，这样就可以自动把原机器上的所有索引迁移到目标机器


导出Mapping信息
elasticdump --ignore-errors=true  --scrollTime=120m  --bulk=true --input=http://10.10.20.164:9200/xmonitor-2015.04.29   --output=http://192.168.100.72:9200/xmonitor-prd-2015.04.29  --type=mapping

导出数据
elasticdump --ignore-errors=true  --scrollTime=120m  --bulk=true --input=http://10.10.20.164:9200/xmonitor-2015.04.28   --output=/usr/local/esdump/node-v0.12.2-linux-x64/data/xmonitor-prd-2015.04.28.json --type=data

导出数据到本地集群
elasticdump --ignore-errors=true  --scrollTime=120m  --bulk=true --input=http://10.10.20.164:9200/xmonitor-2015.04.29   --output=http://192.168.100.72:9200/xmonitor-prd-2015.04.29 --type=data

# Copy an index from production to staging with analyzer and mapping:
elasticdump \
  --input=http://production.es.com:9200/my_index \
  --output=http://staging.es.com:9200/my_index \
  --type=analyzer
elasticdump \
  --input=http://production.es.com:9200/my_index \
  --output=http://staging.es.com:9200/my_index \
  --type=mapping
elasticdump \
  --input=http://production.es.com:9200/my_index \
  --output=http://staging.es.com:9200/my_index \
  --type=data

# Backup index data to a file:
elasticdump \
  --input=http://production.es.com:9200/my_index \
  --output=/data/my_index_mapping.json \
  --type=mapping
elasticdump \
  --input=http://production.es.com:9200/my_index \
  --output=/data/my_index.json \
  --type=data
# Backup and index to a gzip using stdout:
elasticdump \
  --input=http://production.es.com:9200/my_index \
  --output=$ \
  | gzip > /data/my_index.json.gz

# Backup the results of a query to a file
elasticdump \
  --input=http://production.es.com:9200/my_index \
  --output=query.json \
  --searchBody '{"query":{"term":{"username": "admin"}}}'

# Copy a single index from a elasticsearch:
elasticdump \
  --input=http://es.com:9200/api/search \
  --input-index=my_index \
  --output=http://es.com:9200/api/search \
  --output-index=my_index \
  --type=mapping

# Copy a single type:
elasticdump \
  --input=http://es.com:9200/api/search \
  --input-index=my_index/my_type \
  --output=http://es.com:9200/api/search \
  --output-index=my_index \
  --type=mapping

# Copy a single type:
elasticdump \
  --input=http://es.com:9200/api/search \
  --input-index=my_index/my_type \
  --output=http://es.com:9200/api/search \
  --output-index=my_index \
  --type=mapping